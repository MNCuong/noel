<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Realistic 3D Christmas Tree</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  background: radial-gradient(circle at top, #0b2a35, #020b10);
  overflow: hidden;
}
canvas {
  display: block;
}
#hint {
  position: fixed;
  bottom: 20px;
  width: 100%;
  text-align: center;
  color: rgba(255,255,255,0.6);
  font-family: sans-serif;
  font-size: 14px;
  pointer-events: none;
}
</style>
</head>
<body>

<!-- üéµ AUTOPLAY (muted ƒë·ªÉ kh√¥ng b·ªã ch·∫∑n) -->
<audio id="bgm" loop muted>
  <source src="./Lofi Jingle Bells.mp3" type="audio/mpeg">
</audio>

<canvas id="c"></canvas>
<div id="hint">Click anywhere to enable sound üéµ</div>

<script>
const bgm = document.getElementById("bgm");
const hint = document.getElementById("hint");

// üîä b·∫≠t ti·∫øng sau click
let soundEnabled = false;
function enableSound() {
  if (soundEnabled) return;
  soundEnabled = true;

  bgm.muted = false;
  bgm.volume = 0;

  bgm.play().then(() => {
    const fade = setInterval(() => {
      if (bgm.volume < 0.6) {
        bgm.volume += 0.02;
      } else {
        clearInterval(fade);
      }
    }, 120);
  }).catch(err => {
    console.log("Audio play blocked:", err);
  });

  hint.style.display = "none";
}

document.addEventListener("click", enableSound);
document.addEventListener("touchstart", enableSound);

// ================= CANVAS =================
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

let w, h, cx, cy;
function resize() {
  w = canvas.width = window.innerWidth;
  h = canvas.height = window.innerHeight;
  cx = w / 2;
  cy = h * 0.65;
}
window.addEventListener("resize", resize);
resize();

// ================= CONFIG =================
const TREE_HEIGHT = 520;
const TREE_RADIUS = 190;
const TREE_POINTS = 4500;
const STAR_OFFSET = 25;
const STAR_POINTS = 320;
const STAR_OUTER = 14;
const STAR_INNER = 6;
const SIGN_TEXT_1 = "For Manh Manh ‚ùÑÔ∏è";
const SIGN_TEXT_2 = "‚Äî from MNC";
let signGlow = 0;
const ORBIT_TEXT = "üéÅ Gift for Manh Manh üéÑ";
let textAngle = 0;

let rotY = 0;

// ================= TREE =================
const tree = [];
for (let i = 0; i < TREE_POINTS; i++) {
  const t = Math.random();
  const y = -t * TREE_HEIGHT;
  const r = (1 - t) * TREE_RADIUS * (0.5 + Math.random() * 0.7);
  const angle = t * 20 * Math.PI + Math.random();

  const x = Math.cos(angle) * r;
  const z = Math.sin(angle) * r;

  let color;
  if (Math.random() < 0.05) {
    color = "rgb(255,80,80)";
  } else {
    const g = 120 + Math.random() * 100;
    color = `rgb(50,${g},80)`;
  }

  tree.push({ x, y, z, r: Math.random()*1.5+0.4, color });
}
// ================= LUXURY GARLAND =================
const garlands = [];
const GARLAND_LAYERS = 3;

for (let layer = 0; layer < GARLAND_LAYERS; layer++) {
  for (let i = 0; i < 800; i++) {
    const t = i / 800;
    const y = -TREE_HEIGHT * (0.15 + t * 0.7);

    // b√°n k√≠nh gi·∫£m d·∫ßn theo chi·ªÅu cao ‚Üí b√°m c√¢y
    const baseR = TREE_RADIUS * (1 - (y / -TREE_HEIGHT));
    const r = baseR * (1.2 - layer * 0.12);

    // xo·∫Øn theo h√¨nh n√≥n
    const a = t * Math.PI * 10 + layer * 1.6;

    garlands.push({
      x: Math.cos(a) * r,
      y: y + Math.sin(a * 2) * 6,
      z: Math.sin(a) * r,
      r: Math.random() * 1.8 + 0.8,
      sparkle: Math.random() * Math.PI * 2,
      depth: layer
    });
  }
}


// ================= STAR =================
const star = [];
for (let i = 0; i < STAR_POINTS; i++) {
  const arm = Math.floor(Math.random() * 5);
  const base = arm * Math.PI * 2 / 5;
  const outer = Math.random() > 0.5;
  const r = outer ? STAR_OUTER : STAR_INNER;
  const a = base + (outer ? 0 : Math.PI / 5);

  star.push({
    x: Math.cos(a)*r,
    y: -TREE_HEIGHT - STAR_OFFSET,
    z: Math.sin(a)*r,
    r: outer ? 2.5 : 2,
    glow: outer
  });
}
// ================= FIXED NOEL ICONS =================
const orbitIcons = [];
const ICON_TYPES = ["sock", "gift", "bell", "snow"];

for (let i = 0; i < 60; i++) {
  const a = Math.random() * Math.PI * 2;
  const r = TREE_RADIUS + 120 + Math.random() * 160;

  orbitIcons.push({
    x: Math.cos(a) * r,
    z: Math.sin(a) * r,
    y: -Math.random() * TREE_HEIGHT * 0.8,
    size: Math.random() * 6 + 8,
    type: ICON_TYPES[Math.floor(Math.random() * ICON_TYPES.length)],
    sparkle: Math.random() * Math.PI * 2
  });
}


// ================= TRUNK =================
const trunk = [];
for (let i=0;i<300;i++){
  trunk.push({
    x:(Math.random()-0.5)*16,
    y:Math.random()*90,
    z:(Math.random()-0.5)*16,
    r:Math.random()*1.5+0.6
  });
}
// ================= SNOW GROUND =================
const ground = [];
for (let i = 0; i < 1600; i++) {
  const a = Math.random() * Math.PI * 2;
  const r = Math.random() * 420;
  ground.push({
    x: Math.cos(a) * r,
    y: 90 + Math.random() * 2, // s√°t ch√¢n th√¢n c√¢y
    z: Math.sin(a) * r,
    r: Math.random() * 1.8 + 0.6
  });
}

// ================= SNOW =================
const snow=[];
for(let i=0;i<260;i++){
  snow.push({
    x:Math.random()*w-w/2,
    y:Math.random()*h,
    s:Math.random()*1.6+0.3,
    v:Math.random()*0.4+0.5
  });
}

// ================= 3D PROJECT =================
function project(p){
  const cos=Math.cos(rotY), sin=Math.sin(rotY);
  const x=p.x*cos-p.z*sin;
  const z=p.x*sin+p.z*cos+600;
  const s=700/z;
  return {x:cx+x*s,y:cy+p.y*s,r:p.r*s};
}
function projectStatic(p){
  const z = p.z + 600;
  const s = 700 / z;
  return {
    x: cx + p.x * s,
    y: cy + p.y * s,
    r: s
  };
}

function drawIcon(ctx, type, size) {
  ctx.beginPath();

  if (type === "sock") {
    ctx.moveTo(0, 0);
    ctx.lineTo(size * 0.6, 0);
    ctx.lineTo(size * 0.6, size * 0.8);
    ctx.quadraticCurveTo(
      size * 0.6, size,
      size * 0.2, size
    );
    ctx.lineTo(size * 0.2, size * 0.6);
    ctx.lineTo(0, size * 0.6);
    ctx.closePath();
  }

  if (type === "gift") {
    ctx.rect(-size/2, -size/2, size, size);
    ctx.moveTo(0, -size/2);
    ctx.lineTo(0, size/2);
    ctx.moveTo(-size/2, 0);
    ctx.lineTo(size/2, 0);
  }

  if (type === "bell") {
    ctx.arc(0, 0, size * 0.5, Math.PI, 0);
    ctx.lineTo(size * 0.6, size * 0.6);
    ctx.arc(0, size * 0.6, size * 0.6, 0, Math.PI);
    ctx.closePath();
  }

  if (type === "snow") {
    for (let i = 0; i < 6; i++) {
      const a = i * Math.PI / 3;
      ctx.moveTo(0, 0);
      ctx.lineTo(Math.cos(a) * size, Math.sin(a) * size);
    }
  }

  ctx.fill();
  ctx.stroke();
}

// ================= DRAW =================
function draw(){
  ctx.clearRect(0,0,w,h);

  // falling snow
  ctx.fillStyle="rgba(255,255,255,0.8)";
  for(const s of snow){
    s.y+=s.v;
    if(s.y>h) s.y=-10;
    ctx.beginPath();
    ctx.arc(cx+s.x,s.y,s.s,0,Math.PI*2);
    ctx.fill();
  }
// ground snow
for (const p of ground) {
  const s = project(p);
  ctx.fillStyle = "rgba(220,240,255,0.95)";
  ctx.beginPath();
  ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
  ctx.fill();
}

  // trunk
  for(const p of trunk){
    const s=project(p);
    ctx.fillStyle="rgb(90,60,40)";
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fill();
  }

  // tree
  tree.sort((a,b)=>b.z-a.z);
  for(const p of tree){
    const s=project(p);
    ctx.fillStyle=p.color;
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fill();
  }
// garland
// ================= DRAW GARLAND =================
for (const p of garlands) {
  p.sparkle += 0.05;

  const s = project(p);

  // sparkle nh·∫•p nh√°y
  const glow = 0.5 + Math.sin(p.sparkle) * 0.5;

  // m√†u v√†ng luxury (gradient gi·∫£)
  ctx.fillStyle = `rgba(
    ${240 + glow * 15},
    ${200 + glow * 30},
    ${120 + glow * 20},
    ${0.65 + glow * 0.35}
  )`;

  ctx.shadowColor = "rgba(255,220,140,0.9)";
  ctx.shadowBlur = 12 + glow * 10;

  ctx.beginPath();
  ctx.arc(s.x, s.y, s.r * (0.8 + glow * 0.6), 0, Math.PI * 2);
  ctx.fill();
}
ctx.shadowBlur = 0;


  // star
  for(const p of star){
    const s=project(p);
    ctx.fillStyle="gold";
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fill();
  }// orbit stars
// ================= DRAW NOEL ICONS =================
for (const p of orbitIcons) {
  p.sparkle += 0.02;

  const glow = 0.6 + Math.sin(p.sparkle) * 0.4;
  const s = project(p);

  ctx.save();
  ctx.translate(s.x, s.y);
  ctx.scale(s.r * 0.04, s.r * 0.04);

  ctx.fillStyle = `rgba(255,230,180,${0.7 + glow * 0.3})`;
  ctx.strokeStyle = "rgba(255,255,255,0.8)";
  ctx.lineWidth = 1.5;

  ctx.shadowColor = "rgba(255,200,150,0.9)";
  ctx.shadowBlur = 15 + glow * 10;

  drawIcon(ctx, p.type, p.size);

  ctx.restore();
}

// ================= ORBIT TEXT =================
textAngle += 0.002;

ctx.save();
ctx.font = "20px 'Segoe Script', cursive";
ctx.fillStyle = "rgba(255,200,200,0.95)";
ctx.shadowColor = "rgba(255,150,150,0.8)";
ctx.shadowBlur = 10;
ctx.textAlign = "center";

const radiusText = TREE_RADIUS + 85;
const spacing = 0.22; // kho·∫£ng c√°ch ch·ªØ ‚Äì c√†ng nh·ªè c√†ng li·ªÅn

for (let i = 0; i < ORBIT_TEXT.length; i++) {
  const a = textAngle + i * spacing;
  const x = Math.cos(a) * radiusText;
  const z = Math.sin(a) * radiusText;
  const y = -TREE_HEIGHT * 0.35;

  if (z < 0) continue;

  const p = project({ x, y, z, r: 1 });

  ctx.save();
  ctx.translate(p.x, p.y);
  ctx.rotate(a + Math.PI / 2);
  ctx.fillText(ORBIT_TEXT[i], 0, 0);
  ctx.restore();
}

ctx.restore();

// ================= SIGNATURE =================
signGlow += 0.03;

ctx.save();
ctx.textAlign = "right";
ctx.font = "22px 'Segoe Script', cursive";

ctx.shadowColor = "rgba(255,215,150,0.8)";
ctx.shadowBlur = 12 + Math.sin(signGlow) * 4;
ctx.fillStyle = "rgba(255,230,180,0.95)";
ctx.fillText(SIGN_TEXT_1, w - 30, h - 60);

ctx.font = "16px 'Segoe Script', cursive";
ctx.shadowBlur = 8;
ctx.fillStyle = "rgba(255,255,255,0.8)";
ctx.fillText(SIGN_TEXT_2, w - 30, h - 35);
ctx.restore();
ctx.font = "18px serif";
ctx.shadowBlur = 10;
ctx.fillStyle = "rgba(255,120,120,0.9)";
ctx.fillText("‚ô•", w - 200, h - 58);

  rotY+=0.002;
  requestAnimationFrame(draw);
}
draw();
</script>

</body>
</html>
