<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Realistic 3D Christmas Tree</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  background: radial-gradient(circle at top, #0b2a35, #020b10);
  overflow: hidden;
}
canvas {
  display: block;
}
#hint {
  position: fixed;
  bottom: 20px;
  width: 100%;
  text-align: center;
  color: rgba(255,255,255,0.6);
  font-family: sans-serif;
  font-size: 14px;
  pointer-events: none;
}
</style>
</head>
<body>

<!-- ðŸŽµ AUTOPLAY (muted Ä‘á»ƒ khÃ´ng bá»‹ cháº·n) -->
<audio id="bgm" autoplay loop muted>
  <source src="./Lofi Jingle Bells.mp3" type="audio/mpeg">
</audio>

<canvas id="c"></canvas>
<div id="hint">Click anywhere to enable sound ðŸŽµ</div>

<script>
const bgm = document.getElementById("bgm");
const hint = document.getElementById("hint");

// ðŸ”Š báº­t tiáº¿ng sau click
let soundEnabled = false;
function enableSound() {
  if (soundEnabled) return;
  soundEnabled = true;

  bgm.muted = false;
  bgm.volume = 0;

  const fade = setInterval(() => {
    if (bgm.volume < 0.6) {
      bgm.volume += 0.02;
    } else {
      clearInterval(fade);
    }
  }, 120);

  hint.style.display = "none";
}

document.addEventListener("click", enableSound);
document.addEventListener("touchstart", enableSound);

// ================= CANVAS =================
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

let w, h, cx, cy;
function resize() {
  w = canvas.width = window.innerWidth;
  h = canvas.height = window.innerHeight;
  cx = w / 2;
  cy = h * 0.65;
}
window.addEventListener("resize", resize);
resize();

// ================= CONFIG =================
const TREE_HEIGHT = 520;
const TREE_RADIUS = 190;
const TREE_POINTS = 4500;
const STAR_OFFSET = 25;
const STAR_POINTS = 320;
const STAR_OUTER = 14;
const STAR_INNER = 6;
const SIGN_TEXT_1 = "For Manh Manh â„ï¸";
const SIGN_TEXT_2 = "â€” from MNC";
let signGlow = 0;

let rotY = 0;

// ================= TREE =================
const tree = [];
for (let i = 0; i < TREE_POINTS; i++) {
  const t = Math.random();
  const y = -t * TREE_HEIGHT;
  const r = (1 - t) * TREE_RADIUS * (0.5 + Math.random() * 0.7);
  const angle = t * 20 * Math.PI + Math.random();

  const x = Math.cos(angle) * r;
  const z = Math.sin(angle) * r;

  let color;
  if (Math.random() < 0.05) {
    color = "rgb(255,80,80)";
  } else {
    const g = 120 + Math.random() * 100;
    color = `rgb(50,${g},80)`;
  }

  tree.push({ x, y, z, r: Math.random()*1.5+0.4, color });
}

// ================= STAR =================
const star = [];
for (let i = 0; i < STAR_POINTS; i++) {
  const arm = Math.floor(Math.random() * 5);
  const base = arm * Math.PI * 2 / 5;
  const outer = Math.random() > 0.5;
  const r = outer ? STAR_OUTER : STAR_INNER;
  const a = base + (outer ? 0 : Math.PI / 5);

  star.push({
    x: Math.cos(a)*r,
    y: -TREE_HEIGHT - STAR_OFFSET,
    z: Math.sin(a)*r,
    r: outer ? 2.5 : 2,
    glow: outer
  });
}

// ================= TRUNK =================
const trunk = [];
for (let i=0;i<300;i++){
  trunk.push({
    x:(Math.random()-0.5)*16,
    y:Math.random()*90,
    z:(Math.random()-0.5)*16,
    r:Math.random()*1.5+0.6
  });
}
// ================= SNOW GROUND =================
const ground = [];
for (let i = 0; i < 1600; i++) {
  const a = Math.random() * Math.PI * 2;
  const r = Math.random() * 420;
  ground.push({
    x: Math.cos(a) * r,
    y: 90 + Math.random() * 2, // sÃ¡t chÃ¢n thÃ¢n cÃ¢y
    z: Math.sin(a) * r,
    r: Math.random() * 1.8 + 0.6
  });
}

// ================= SNOW =================
const snow=[];
for(let i=0;i<260;i++){
  snow.push({
    x:Math.random()*w-w/2,
    y:Math.random()*h,
    s:Math.random()*1.6+0.3,
    v:Math.random()*0.4+0.2
  });
}

// ================= 3D PROJECT =================
function project(p){
  const cos=Math.cos(rotY), sin=Math.sin(rotY);
  const x=p.x*cos-p.z*sin;
  const z=p.x*sin+p.z*cos+600;
  const s=700/z;
  return {x:cx+x*s,y:cy+p.y*s,r:p.r*s};
}

// ================= DRAW =================
function draw(){
  ctx.clearRect(0,0,w,h);

  // falling snow
  ctx.fillStyle="rgba(255,255,255,0.8)";
  for(const s of snow){
    s.y+=s.v;
    if(s.y>h) s.y=-10;
    ctx.beginPath();
    ctx.arc(cx+s.x,s.y,s.s,0,Math.PI*2);
    ctx.fill();
  }
// ground snow
for (const p of ground) {
  const s = project(p);
  ctx.fillStyle = "rgba(220,240,255,0.95)";
  ctx.beginPath();
  ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
  ctx.fill();
}

  // trunk
  for(const p of trunk){
    const s=project(p);
    ctx.fillStyle="rgb(90,60,40)";
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fill();
  }

  // tree
  tree.sort((a,b)=>b.z-a.z);
  for(const p of tree){
    const s=project(p);
    ctx.fillStyle=p.color;
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fill();
  }

  // star
  for(const p of star){
    const s=project(p);
    ctx.fillStyle="gold";
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fill();
  }
// ================= SIGNATURE =================
signGlow += 0.03;

ctx.save();
ctx.textAlign = "right";
ctx.font = "22px 'Segoe Script', cursive";

ctx.shadowColor = "rgba(255,215,150,0.8)";
ctx.shadowBlur = 12 + Math.sin(signGlow) * 4;
ctx.fillStyle = "rgba(255,230,180,0.95)";
ctx.fillText(SIGN_TEXT_1, w - 30, h - 60);

ctx.font = "16px 'Segoe Script', cursive";
ctx.shadowBlur = 8;
ctx.fillStyle = "rgba(255,255,255,0.8)";
ctx.fillText(SIGN_TEXT_2, w - 30, h - 35);
ctx.restore();
ctx.font = "18px serif";
ctx.shadowBlur = 10;
ctx.fillStyle = "rgba(255,120,120,0.9)";
ctx.fillText("â™¥", w - 200, h - 58);

  rotY+=0.0022;
  requestAnimationFrame(draw);
}
draw();
</script>

</body>
</html>
