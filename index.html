<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title> Merry Christmas Manh Manh üéÑ</title>
<style>
  html, body {
    margin: 0; padding: 0;
    background: radial-gradient(circle at center, #051923 0%, #000508 100%);
    overflow: hidden; height: 100%;
  }
  canvas { display: block; }
  
  #scrolling-text {
    position: fixed; bottom: 50px; white-space: nowrap; width: 100%;
    color: #ffcf71; font-family: 'Segoe Script', cursive, sans-serif;
    font-size: 26px; text-shadow: 0 0 15px rgba(255, 165, 0, 0.7);
    pointer-events: none; overflow: hidden; z-index: 100;
  }
  .marquee {
    display: inline-block; padding-left: 100%;
    animation: marquee 35s linear infinite;
  }
  @keyframes marquee {
    0% { transform: translate(0, 0); }
    100% { transform: translate(-100%, 0); }
  }
</style>
</head>
<body>

<audio id="bgm" autoplay loop muted>
  <source src="./Lofi Jingle Bells.mp3" type="audio/mpeg">
</audio>

<div id="scrolling-text">
  <div class="marquee">
    Merry Christmas Manh Manh ‚ùÑÔ∏è Ch√∫c Manh m·ªôt m√πa Gi√°ng sinh ·∫•m √°p, lung linh v√† lu√¥n r·∫°ng r·ª° nh∆∞ nh·ªØng √°nh sao n√†y! ‚ú® üéÑ üéÅ ‚ô•Ô∏è
  </div>
</div>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

let w, h, cx, cy;
function resize() {
  w = canvas.width = window.innerWidth;
  h = canvas.height = window.innerHeight;
  cx = w / 2;
  cy = h * 0.8;
}
window.addEventListener("resize", resize);
resize();

// ================= CONFIG 3D =================
const TREE_HEIGHT = 520;
const TREE_RADIUS = 200;
let rotY = 0;

// 1. T·∫°o Tuy·∫øt r∆°i to√†n m√†n h√¨nh
const snowfall = Array.from({ length: 200 }, () => ({
  x: Math.random() * w, y: Math.random() * h,
  s: Math.random() * 2 + 1, v: Math.random() * 1 + 0.5
}));

// 2. T·∫°o S√¢n tuy·∫øt 3D
const ground = Array.from({ length: 800 }, () => {
  const a = Math.random() * Math.PI * 2;
  const r = Math.pow(Math.random(), 0.5) * 500;
  return { x: Math.cos(a) * r, y: 30, z: Math.sin(a) * r, r: Math.random() * 2 + 1 };
});

// 3. T·∫°o C√¢y (L√° v√† Qu·∫£)
const treePoints = Array.from({ length: 6000 }, () => {
  const t = Math.random();
  const y = -t * TREE_HEIGHT;
  const r = (1 - t) * TREE_RADIUS * (0.6 + Math.random() * 0.4);
  const angle = Math.random() * Math.PI * 2;
  return {
    x: Math.cos(angle) * r, y, z: Math.sin(angle) * r,
    r: Math.random() * 1.5 + 0.5,
    color: Math.random() < 0.1 ? "#e63946" : `rgb(20, ${100 + Math.random() * 80}, 40)`, // ƒê·ªè ho·∫∑c Xanh
    twinkle: Math.random() * Math.PI
  };
});

// 4. T·∫°o D·∫£i ruy bƒÉng 3D
const garlands = Array.from({ length: 1800 }, (_, i) => {
  const t = i / 1800;
  const y = -t * TREE_HEIGHT;
  const r = (1 - t) * TREE_RADIUS * 1.05;
  const angle = t * Math.PI * 15;
  return { x: Math.cos(angle) * r, y, z: Math.sin(angle) * r };
});

// 5. T·∫°o c√°c Icon Noel (V·∫Ω b·∫±ng code ƒë·ªÉ c√≥ m√†u ƒê·ªè/Tr·∫Øng/Xanh)
const icons = Array.from({ length: 30 }, () => {
  const angle = Math.random() * Math.PI * 2;
  const r = TREE_RADIUS + 80 + Math.random() * 100;
  return {
    x: Math.cos(angle) * r, y: -Math.random() * TREE_HEIGHT, z: Math.sin(angle) * r,
    type: Math.floor(Math.random() * 3), // 0: Qu√†, 1: Chu√¥ng, 2: K·∫πo
    color: ["#f1faee", "#e63946", "#ffd700"][Math.floor(Math.random() * 3)],
    phase: Math.random() * Math.PI * 2
  };
});

function project(p) {
  const cos = Math.cos(rotY), sin = Math.sin(rotY);
  const x = p.x * cos - p.z * sin;
  const z = p.x * sin + p.z * cos + 1000;
  const s = 1200 / z;
  return { x: cx + x * s, y: cy + p.y * s, r: (p.r || 2) * s, z: z, s: s };
}

function drawGift(ctx, x, y, size, color) {
  ctx.fillStyle = color;
  ctx.fillRect(x - size/2, y - size/2, size, size);
  ctx.fillStyle = "#e63946"; // N∆° ƒë·ªè
  ctx.fillRect(x - size/2, y - 2, size, 4);
  ctx.fillRect(x - 2, y - size/2, 4, size);
}

function drawBell(ctx, x, y, size) {
  ctx.fillStyle = "#ffd700";
  ctx.beginPath();
  ctx.arc(x, y, size/2, Math.PI, 0);
  ctx.lineTo(x + size/2, y + size/2);
  ctx.lineTo(x - size/2, y + size/2);
  ctx.fill();
}

function draw() {
  ctx.clearRect(0, 0, w, h);

  // --- Tuy·∫øt r∆°i (N·ªÅn) ---
  ctx.fillStyle = "rgba(255, 255, 255, 0.5)";
  snowfall.forEach(s => {
    s.y += s.v; if (s.y > h) s.y = -10;
    ctx.beginPath(); ctx.arc(s.x, s.y, s.s, 0, Math.PI * 2); ctx.fill();
  });

  // --- S√¢n tuy·∫øt 3D ---
  ground.forEach(p => {
    const s = project(p);
    ctx.fillStyle = `rgba(241, 250, 238, ${Math.max(0, 1 - s.z/1800)})`;
    ctx.beginPath(); ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2); ctx.fill();
  });

  // --- Gom t·∫•t c·∫£ c√°c v·∫≠t th·ªÉ 3D ƒë·ªÉ s·∫Øp x·∫øp theo ƒë·ªô s√¢u (Z-Index) ---
  const scene = [
    ...treePoints.map(p => ({ ...project(p), type: 'tree', rawColor: p.color, twinkle: p.twinkle })),
    ...garlands.map(p => ({ ...project(p), type: 'garland' })),
    ...icons.map(p => ({ ...project(p), type: 'icon', iconType: p.type, color: p.color, phase: p.phase }))
  ];
  scene.sort((a, b) => b.z - a.z); // V·∫Ω t·ª´ xa t·ªõi g·∫ßn

  scene.forEach(p => {
    ctx.globalAlpha = Math.max(0.1, 1.2 - p.z/1800);
    
    if (p.type === 'tree') {
      const t = 0.6 + Math.sin(Date.now() * 0.003 + p.twinkle) * 0.4;
      ctx.fillStyle = p.rawColor;
      if(p.rawColor === "#e63946") ctx.globalAlpha *= t; // Qu·∫£ ƒë·ªè nh·∫•p nh√°y
      ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2); ctx.fill();
    } 
    else if (p.type === 'garland') {
      ctx.fillStyle = "#ffd700";
      ctx.shadowBlur = 10; ctx.shadowColor = "gold";
      ctx.beginPath(); ctx.arc(p.x, p.y, p.r * 0.6, 0, Math.PI * 2); ctx.fill();
      ctx.shadowBlur = 0;
    } 
    else if (p.type === 'icon') {
      const bounce = Math.sin(Date.now() * 0.002 + p.phase) * 15;
      if (p.iconType === 0) drawGift(ctx, p.x, p.y + bounce, p.s * 20, p.color);
      else if (p.iconType === 1) drawBell(ctx, p.x, p.y + bounce, p.s * 20);
      else {
        ctx.font = `${p.s * 25}px Arial`; ctx.fillText("üç≠", p.x, p.y + bounce);
      }
    }
    ctx.globalAlpha = 1;
  });

  // --- Ng√¥i sao ƒë·ªânh (Lu√¥n ·ªü tr√™n c√πng) ---
  const starTop = project({ x: 0, y: -TREE_HEIGHT - 30, z: 0, r: 25 });
  ctx.save();
  ctx.shadowBlur = 30; ctx.shadowColor = "#ffd700";
  ctx.fillStyle = "#fff";
  ctx.beginPath();
  for(let i=0; i<10; i++) {
    const r = i%2===0 ? starTop.r : starTop.r/2;
    const a = i * Math.PI / 5 - Math.PI/2;
    ctx.lineTo(starTop.x + Math.cos(a)*r, starTop.y + Math.sin(a)*r);
  }
  ctx.closePath(); ctx.fill();
  ctx.restore();

  rotY += 0.008;
  requestAnimationFrame(draw);
}

// B·∫≠t nh·∫°c khi click
document.addEventListener("click", () => {
  const bgm = document.getElementById("bgm");
  bgm.muted = false;
  bgm.play();
});

draw();
</script>
</body>
</html>